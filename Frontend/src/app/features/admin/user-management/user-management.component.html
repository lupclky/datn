<div class="user-management">
  <p-toast></p-toast>
  <div class="page-header">
    <div>
      <h1 class="page-title">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
      <p class="page-subtitle">Qu·∫£n l√Ω t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng</p>
    </div>
    <button class="btn btn-primary" (click)="openAddUserModal()">
      <span>‚ûï</span> Th√™m ng∆∞·ªùi d√πng
    </button>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchKeyword" 
        (input)="searchUsers()"
        placeholder="üîç T√¨m ki·∫øm theo t√™n, s·ªë ƒëi·ªán tho·∫°i, email..."
        class="search-input">
    </div>
  </div>

  <div class="users-table" *ngIf="!isLoading && filteredUsers.length > 0">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>H·ªç t√™n</th>
          <th>S·ªë ƒëi·ªán tho·∫°i</th>
          <th>Email</th>
          <th>Vai tr√≤</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng√†y t·∫°o</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>{{ user.id }}</td>
          <td>
            <div class="user-info">
              <strong>{{ user.fullname || 'N/A' }}</strong>
            </div>
          </td>
          <td>{{ user.phone_number }}</td>
          <td>{{ user.email || 'N/A' }}</td>
          <td>
            <span class="badge" [class.badge-admin]="user.role?.name === 'ADMIN'" [class.badge-user]="user.role?.name === 'USER'">
              {{ user.role?.name || 'N/A' }}
            </span>
          </td>
          <td>
            <span class="badge" [class.badge-active]="user.is_active" [class.badge-inactive]="!user.is_active">
              {{ user.is_active ? 'Ho·∫°t ƒë·ªông' : 'Kh√≥a' }}
            </span>
          </td>
          <td>{{ formatDate(user.created_at) }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-edit" (click)="editUser(user)" title="S·ª≠a">
                ‚úèÔ∏è
              </button>
              <button class="btn btn-sm btn-toggle" (click)="toggleUserStatus(user)" [title]="user.is_active ? 'Kh√≥a' : 'M·ªü kh√≥a'">
                {{ user.is_active ? 'üîí' : 'üîì' }}
              </button>
              <button class="btn btn-sm btn-delete" (click)="deleteUser(user)" title="X√≥a">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i danh s√°ch ng∆∞·ªùi d√πng...</p>
  </div>

  <div class="empty-state" *ngIf="!isLoading && filteredUsers.length === 0">
    <div class="icon">üì≠</div>
    <h3>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng</h3>
    <p>Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
  </div>
</div>

<!-- Modal for Add/Edit User -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditing ? 'S·ª≠a ng∆∞·ªùi d√πng' : 'Th√™m ng∆∞·ªùi d√πng m·ªõi' }}</h2>
      <button class="close-btn" (click)="closeModal()">‚úï</button>
    </div>

    <form class="modal-body">
      <div class="form-group">
        <label>H·ªç t√™n *</label>
        <input type="text" [(ngModel)]="currentUser.fullname" name="fullname" class="form-control" placeholder="Nh·∫≠p h·ªç t√™n" />
      </div>

      <div class="form-group">
        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
        <input type="text" [(ngModel)]="currentUser.phone_number" name="phone_number" class="form-control" placeholder="0123456789" />
      </div>

      <div class="form-group" *ngIf="!isEditing">
        <label>M·∫≠t kh·∫©u *</label>
        <input type="password" [(ngModel)]="currentUser.password" name="password" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" />
      </div>

      <div class="form-group" *ngIf="!isEditing">
        <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u *</label>
        <input type="password" [(ngModel)]="currentUser.retypePassword" name="retypePassword" class="form-control" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" [(ngModel)]="currentUser.email" name="email" class="form-control" placeholder="example@email.com" />
      </div>

      <div class="form-group">
        <label>ƒê·ªãa ch·ªâ</label>
        <input type="text" [(ngModel)]="currentUser.address" name="address" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" />
      </div>

      <div class="form-group">
        <label>Vai tr√≤</label>
        <select [(ngModel)]="currentUser.role_id" name="role_id" class="form-control">
          <option [value]="2">USER</option>
          <option [value]="1">ADMIN</option>
        </select>
      </div>

      <div class="form-group" *ngIf="isEditing">
        <label>Tr·∫°ng th√°i</label>
        <select [(ngModel)]="currentUser.is_active" name="is_active" class="form-control">
          <option [value]="true">Ho·∫°t ƒë·ªông</option>
          <option [value]="false">Kh√≥a</option>
        </select>
      </div>
    </form>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="saveUser()">{{ isEditing ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi' }}</button>
    </div>
  </div>
</div>
